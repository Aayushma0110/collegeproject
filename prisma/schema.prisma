generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int           @id @default(autoincrement())
  name                String
  email               String        @unique
  password            String

  dateOfBirth         DateTime?
  gender              String?
  medicalHistory      String?

  specialty           String?
  experience          Int?
  fees                Float?
  ratings             Float?
  availability        Json?  
  scheduledAt         DateTime?

  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt

  status              DoctorStatus  @default(PENDING)
  role                Role

  phoneNumber         String[]
  profilePicture_     String[]

  doctorAppointments  Appointment[] @relation("DoctorAppointments")
  patientAppointments Appointment[] @relation("PatientAppointments")
  reviewsGiven        Review[]       @relation("ReviewsGiven")
  reviewsReceived     Review[]       @relation("ReviewsReceived")
}


model Appointment {
  id          Int      @id @default(autoincrement())
  mode        Mode     @default(IN_PERSON)
  status      Status   @default(PENDING)
  patientId   Int
  doctorId    Int
  createdAt   DateTime @default(now())
  duration    Int?
  scheduledAt DateTime
  doctor      User     @relation("DoctorAppointments", fields: [doctorId], references: [id])
  patient     User     @relation("PatientAppointments", fields: [patientId], references: [id])
  payment     Payment?
  review      Review?
}

model Payment {
  id            Int           @id @default(autoincrement())
  amount        Float
  method        PaymentMethod
  status        PaymentStatus @default(PENDING)
  transactionId String?
  appointmentId Int           @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  appointment   Appointment   @relation(fields: [appointmentId], references: [id])
}
model Review {
  id            Int      @id @default(autoincrement())
  rating        Int      // A rating from 1 to 5
  comment       String?
  
  appointment   Appointment @relation(fields: [appointmentId], references: [id])
  appointmentId Int      @unique // One review per appointment

  reviewer      User     @relation("ReviewsGiven", fields: [reviewerId], references: [id])
  reviewerId    Int      // The patient who wrote the review

  doctor        User     @relation("ReviewsReceived", fields: [doctorId], references: [id])
  doctorId      Int      // The doctor being reviewed

  createdAt     DateTime @default(now())
}

enum Role {
  PATIENT
  DOCTOR
  ADMIN
}

enum Mode {
  IN_PERSON
  ONLINE
}

enum Status {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentMethod {
  CASH
  CARD
  STRIPE
  ESEWA
  KHALTI
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

enum DoctorStatus {
  PENDING
  APPROVED
  REJECTED
}